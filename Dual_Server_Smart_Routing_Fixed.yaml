# 双服务器智能分流配置 - 修复版
# 美国西雅图 + 香港CMI 智能路由

port: 7890
socks-port: 7891
allow-lan: true
mode: rule
log-level: info
external-controller: 127.0.0.1:9090

# 优化DNS配置
dns:
  enable: true
  enhanced-mode: fake-ip
  fake-ip-range: 198.18.0.1/16
  nameserver:
    - 8.8.8.8
    - 1.1.1.1
    - 208.67.222.222
  fallback:
    - 8.8.4.4
    - 1.0.0.1
    - 9.9.9.9

proxies:
  # 美国西雅图服务器 - AI专用
  - name: "US-Seattle-Reality"
    type: vless
    server: 104.247.120.132
    port: 443
    uuid: fbe68161-340d-4721-aff4-b0efc1d03bdb
    flow: xtls-rprx-vision
    tls: true
    network: tcp
    reality-opts:
      public-key: 0bMB_OETOiU-J2lr3aoHdBfOIiJzrDYZH1mmYa3_lhU
      short-id: e22fc234aa2b0560
    client-fingerprint: chrome
    servername: www.apple.com

  - name: "US-Seattle-Hysteria2"
    type: hysteria2
    server: 104.247.120.132
    port: 443
    password: SeattleAI2025_1da9543d07a41781
    obfs: salamander
    obfs-password: homeRouter_2ca57d650199
    sni: www.apple.com
    skip-cert-verify: true
    up: 500
    down: 1000

  # 香港CMI服务器 - 流媒体+交易专用
  - name: "HK-CMI-Reality"
    type: vless
    server: 38.22.93.165
    port: 443
    uuid: 5dc648a5-96a6-4ad8-a6e3-d0bb6f00850d
    flow: xtls-rprx-vision
    tls: true
    network: tcp
    reality-opts:
      public-key: FvvA271bTh51H7d69nmyriujFP0agStXM4dXEkK46xc
      short-id: d35b027ab42e9018
    client-fingerprint: chrome
    servername: www.binance.com

  - name: "HK-CMI-Hysteria2"
    type: hysteria2
    server: 38.22.93.165
    port: 8443
    password: HKBinance2025_a946373f443e2c4c
    obfs: salamander
    obfs-password: cmi_90a632b97eac
    sni: www.binance.com
    skip-cert-verify: true
    up: 500
    down: 800

proxy-groups:
  # AI服务专用组
  - name: "AI-Services"
    type: select
    proxies:
      - "US-Seattle-Reality"
      - "US-Seattle-Hysteria2"

  # 流媒体专用组
  - name: "Streaming"
    type: select
    proxies:
      - "HK-CMI-Hysteria2"
      - "HK-CMI-Reality"

  # Binance交易专用
  - name: "Binance-Trading"
    type: select
    proxies:
      - "HK-CMI-Hysteria2"
      - "HK-CMI-Reality"

  # Apple服务
  - name: "Apple-Services"
    type: select
    proxies:
      - "US-Seattle-Reality"
      - "HK-CMI-Reality"
      - "DIRECT"

  # 国外社交媒体
  - name: "Social-Media"
    type: select
    proxies:
      - "Auto-Select"
      - "HK-CMI-Reality"
      - "US-Seattle-Reality"

  # 智能选择组
  - name: "Auto-Select"
    type: url-test
    proxies:
      - "HK-CMI-Reality"
      - "US-Seattle-Reality"
      - "HK-CMI-Hysteria2"
      - "US-Seattle-Hysteria2"
    url: "http://www.gstatic.com/generate_204"
    interval: 120
    timeout: 3000

  # 国外网站
  - name: "Foreign-Sites"
    type: select
    proxies:
      - "Auto-Select"
      - "HK-CMI-Reality"
      - "US-Seattle-Reality"

  # 国内直连
  - name: "China-Direct"
    type: select
    proxies:
      - "DIRECT"

rules:
  # AI服务规则
  - DOMAIN-SUFFIX,openai.com,AI-Services
  - DOMAIN-SUFFIX,anthropic.com,AI-Services
  - DOMAIN-SUFFIX,claude.ai,AI-Services
  - DOMAIN-SUFFIX,chatgpt.com,AI-Services
  - DOMAIN-KEYWORD,openai,AI-Services
  - DOMAIN-KEYWORD,chatgpt,AI-Services
  - DOMAIN-KEYWORD,claude,AI-Services

  # Binance交易规则
  - DOMAIN-SUFFIX,binance.com,Binance-Trading
  - DOMAIN-SUFFIX,binance.org,Binance-Trading
  - DOMAIN-SUFFIX,bnbstatic.com,Binance-Trading
  - DOMAIN-SUFFIX,binance.me,Binance-Trading
  - DOMAIN-KEYWORD,binance,Binance-Trading

  # 流媒体规则
  - DOMAIN-SUFFIX,netflix.com,Streaming
  - DOMAIN-SUFFIX,netflix.net,Streaming
  - DOMAIN-SUFFIX,nflximg.net,Streaming
  - DOMAIN-SUFFIX,nflximg.com,Streaming
  - DOMAIN-SUFFIX,nflxvideo.net,Streaming
  - DOMAIN-SUFFIX,nflxso.net,Streaming
  - DOMAIN-KEYWORD,netflix,Streaming

  - DOMAIN-SUFFIX,youtube.com,Streaming
  - DOMAIN-SUFFIX,googlevideo.com,Streaming
  - DOMAIN-SUFFIX,ytimg.com,Streaming
  - DOMAIN-KEYWORD,youtube,Streaming

  - DOMAIN-SUFFIX,disneyplus.com,Streaming
  - DOMAIN-SUFFIX,hulu.com,Streaming
  - DOMAIN-SUFFIX,primevideo.com,Streaming
  - DOMAIN-SUFFIX,hbo.com,Streaming
  - DOMAIN-SUFFIX,hbomax.com,Streaming

  # Apple服务
  - DOMAIN-SUFFIX,apple.com,Apple-Services
  - DOMAIN-SUFFIX,icloud.com,Apple-Services
  - DOMAIN-SUFFIX,appstore.com,Apple-Services
  - DOMAIN-SUFFIX,itunes.com,Apple-Services

  # 国外社交媒体
  - DOMAIN-SUFFIX,twitter.com,Social-Media
  - DOMAIN-SUFFIX,x.com,Social-Media
  - DOMAIN-SUFFIX,instagram.com,Social-Media
  - DOMAIN-SUFFIX,facebook.com,Social-Media
  - DOMAIN-SUFFIX,fb.com,Social-Media
  - DOMAIN-SUFFIX,whatsapp.com,Social-Media
  - DOMAIN-SUFFIX,linkedin.com,Social-Media
  - DOMAIN-SUFFIX,reddit.com,Social-Media
  - DOMAIN-SUFFIX,discord.com,Social-Media
  - DOMAIN-SUFFIX,snapchat.com,Social-Media

  # Telegram添加到流媒体组（因为有视频内容）
  - DOMAIN-SUFFIX,telegram.org,Streaming
  - DOMAIN-SUFFIX,t.me,Streaming
  - DOMAIN-KEYWORD,telegram,Streaming

  # 国内网站和应用直连
  - DOMAIN-SUFFIX,cn,China-Direct
  - DOMAIN-KEYWORD,-cn,China-Direct
  
  # 国内主要网站
  - DOMAIN-SUFFIX,baidu.com,China-Direct
  - DOMAIN-SUFFIX,taobao.com,China-Direct
  - DOMAIN-SUFFIX,jd.com,China-Direct
  - DOMAIN-SUFFIX,alipay.com,China-Direct
  
  # 国内社交媒体和通讯
  - DOMAIN-SUFFIX,qq.com,China-Direct
  - DOMAIN-SUFFIX,weixin.qq.com,China-Direct
  - DOMAIN-KEYWORD,wechat,China-Direct
  - DOMAIN-SUFFIX,xiaohongshu.com,China-Direct
  - DOMAIN-SUFFIX,xhscdn.com,China-Direct
  - DOMAIN-SUFFIX,bilibili.com,China-Direct
  - DOMAIN-SUFFIX,bilivideo.com,China-Direct
  
  # 抖音系列
  - DOMAIN-SUFFIX,douyin.com,China-Direct
  - DOMAIN-SUFFIX,douyinpic.com,China-Direct
  - DOMAIN-SUFFIX,douyincdn.com,China-Direct
  - DOMAIN-SUFFIX,douyinvod.com,China-Direct
  - DOMAIN-KEYWORD,douyin,China-Direct

  # 局域网直连
  - IP-CIDR,192.168.0.0/16,DIRECT
  - IP-CIDR,10.0.0.0/8,DIRECT
  - IP-CIDR,172.16.0.0/12,DIRECT
  - IP-CIDR,127.0.0.0/8,DIRECT

  # 中国IP直连
  - GEOIP,CN,China-Direct

  # 默认走智能选择
  - MATCH,Foreign-Sites
